# 威软Claude用量检测 🔍

<p align="center">
  <img src="https://img.shields.io/badge/版本-3.0.0-blue.svg" alt="版本">
  <img src="https://img.shields.io/badge/许可证-MIT-green.svg" alt="许可证">
  <img src="https://img.shields.io/badge/平台-Tampermonkey-orange.svg" alt="平台">
</p>

> 一款功能强大的 Claude AI 用量检测油猴脚本，**真实API用量监控**、**现代化深色界面**、**历史数据图表**、恢复时间倒计时等功能。

**署名：威软科技 (WeiRuan Tech)**

---

## ✨ 功能特性

### 🆕 v3.0 重大更新
- **真实API用量** - 直接调用Claude官方API获取准确用量数据
- **现代化深色界面** - 全新设计的暗色主题，渐变配色
- **三种用量指标** - 5小时会话用量、7天总用量、7天Opus用量
- **账户信息显示** - 显示当前账户邮箱和头像
- **智能刷新倒计时** - 显示用量重置的精确倒计时
- **完全可拖拽** - 面板位置自动保存
- **折叠为圆形按钮** - 最小化时不占用屏幕空间

### 核心功能
- **实时用量检测** - 每分钟自动刷新用量数据
- **恢复时间倒计时** - 显示精确的重置倒计时
- **历史数据图表** - 可视化7/14/30天用量趋势
- **数据导出** - 导出统计数据为 JSON 文件

### 扩展功能
- **可拖拽面板** - 支持自由拖动到任意位置
- **折叠/展开** - 一键折叠为圆形图标
- **桌面通知** - 限制触发时发送通知提醒
- **本地存储** - 数据持久化保存，刷新不丢失

---

## 📊 用量指标说明

| 指标 | 说明 | 重置周期 |
|------|------|---------|
| 5小时会话 | 当前会话窗口的用量百分比 | 5小时滚动 |
| 7天总用量 | 过去7天所有模型的总用量 | 7天滚动 |
| 7天Opus | 过去7天Opus模型的用量 | 7天滚动 |

> 数据直接来自Claude官方API，准确可靠

---

## 📦 安装方法

### 前置要求
请先安装以下任一浏览器扩展：
- [Tampermonkey](https://www.tampermonkey.net/) (推荐)
- [Violentmonkey](https://violentmonkey.github.io/)
- [Greasemonkey](https://www.greasespot.net/) (仅 Firefox)

### 安装步骤

1. **安装油猴扩展**（如已安装可跳过）
2. **点击下方链接安装脚本**
   - [直接安装](./weiruan-claude-usage-detector.user.js)
3. **或手动安装**
   - 打开油猴扩展管理面板
   - 点击「新建脚本」
   - 复制 `weiruan-claude-usage-detector.user.js` 内容并粘贴
   - 保存并启用

---

## 🖥️ 使用说明

### 面板说明
安装后访问 [claude.ai](https://claude.ai)，右上角将显示检测面板：

```
┌─────────────────────────────────────┐
│ 📊 威软Claude用量     🔄  ─         │
├─────────────────────────────────────┤
│ 👤 user@example.com                 │
├─────────────────────────────────────┤
│ 5小时会话                           │
│ ██████████░░░░░░░░░░  45%           │
│ 重置于: 2小时30分                   │
├─────────────────────────────────────┤
│ 7天总用量                           │
│ ████░░░░░░░░░░░░░░░░  22%           │
├─────────────────────────────────────┤
│ 7天Opus                             │
│ ██░░░░░░░░░░░░░░░░░░  15%           │
├─────────────────────────────────────┤
│ ▼ 历史趋势      [7天] [14天] [30天] │
│   ▁ ▃ █ ▅ ▂ ▇ ▄                    │
│ ┌─────────┬─────────┐               │
│ │ 日均:15 │ 总量:89 │               │
│ │ 最高:32 │ 限制:1  │               │
│ └─────────┴─────────┘               │
├─────────────────────────────────────┤
│  [导出]  [重置]                     │
├─────────────────────────────────────┤
│   v3.0.0 | GitHub | 威软科技        │
└─────────────────────────────────────┘
```

### 折叠状态
点击折叠按钮后，面板会变成一个圆形图标：
```
 ┌───┐
 │ 📊 │  ← 点击展开
 └───┘
```

### 用量百分比颜色说明

| 百分比范围 | 颜色 | 说明 |
|-----------|------|------|
| 0% - 49% | 🟢 绿色 | 用量充足 |
| 50% - 79% | 🟡 黄色 | 用量中等 |
| 80% - 100% | 🔴 红色 | 用量紧张 |

### 功能按钮

| 按钮 | 功能 |
|------|------|
| 🔄 | 手动刷新用量数据 |
| ─ / + | 折叠/展开面板 |
| 导出 | 下载 JSON 格式统计数据 |
| 重置 | 清除历史数据 |

---

## 🔧 配置选项

可在脚本开头的 `CONFIG` 对象中自定义配置：

```javascript
const CONFIG = {
    VERSION: '3.0.0',
    STORAGE_PREFIX: 'weiruan_claude_v3_',
    UPDATE_INTERVAL: 60000,  // 更新间隔（毫秒）
    HISTORY_DAYS: 30,        // 历史数据保留天数
    DEBUG: false             // 调试模式
};
```

---

## 📊 导出数据格式

```json
{
  "exportTime": "2025-01-10T10:30:00.000Z",
  "version": "3.0.0",
  "account": {
    "email": "user@example.com"
  },
  "usage": {
    "five_hour": {
      "utilization": 0.45,
      "resets_at": "2025-01-10T13:00:00.000Z"
    },
    "seven_day": {
      "utilization": 0.22,
      "resets_at": "2025-01-17T00:00:00.000Z"
    },
    "seven_day_opus": {
      "utilization": 0.15,
      "resets_at": "2025-01-17T00:00:00.000Z"
    }
  },
  "historyData": {
    "2025-01-09": { "usage": 45, "limited": false },
    "2025-01-08": { "usage": 32, "limited": false }
  }
}
```

---

## 🔒 隐私说明

- 所有数据仅存储在本地浏览器中
- 仅调用Claude官方API获取您自己的用量数据
- 不会向任何第三方服务器发送数据
- 不收集任何个人信息
- 完全开源，代码可审查

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

1. Fork 本仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 提交 Pull Request

---

## 📝 更新日志

### v3.0.0 (2025-01-10)
- 🎉 **重大重构** - 全新架构设计
- 🆕 **真实API** - 直接调用Claude官方API获取准确用量
- 🆕 **三种用量指标** - 5小时会话、7天总用量、7天Opus
- 🆕 **账户信息** - 显示当前登录账户
- 🆕 **现代化UI** - 全新深色主题设计
- 🆕 **折叠为圆形** - 最小化时变成圆形图标
- 🆕 **精确倒计时** - 显示用量重置的精确时间
- 🔧 **位置记忆** - 面板位置自动保存

### v2.2.0 (2025-01-09)
- 🆕 历史数据图表 - 可视化7/14/30天用量趋势
- 🆕 历史统计摘要（日均、总量、最高、限制次数）
- 🆕 交互式柱状图（悬停显示详情）
- 🆕 历史数据自动保存30天

### v2.1.0 (2025-01-09)
- 🔧 修复用量检测问题
- 🆕 多重检测机制（Fetch/XHR/DOM/事件）
- 🆕 防重复计数（1秒内去重）

### v2.0.0 (2025-01-09)
- 🆕 智能版本检测 (Free/Pro/Team/Max/Enterprise)
- 🆕 用量百分比显示（日用量/周用量）
- 🆕 进度条颜色分级（绿/黄/红）
- 🆕 手动版本切换功能

### v1.0.0 (2025-01-09)
- 🎉 首次发布
- ✅ 实时用量检测
- ✅ 恢复时间倒计时
- ✅ 消息统计功能
- ✅ 数据导出功能
- ✅ 深色模式支持
- ✅ 可拖拽面板

---

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

---

## 👨‍💻 作者

**威软科技 (WeiRuan Tech)**

- GitHub: [@weiruankeji2025](https://github.com/weiruankeji2025)

---

<p align="center">
  Made with ❤️ by 威软科技
</p>
